ğŸ›¡ï¸ Tá»•ng quan: XÃ¡c thá»±c vá»›i JWT trong Spring Security
DÃ²ng cháº£y chÃ­nh lÃ :
Filter Ä‘á»c token âŸ¶ truyá»n cho AuthenticationManager âŸ¶ xá»­ lÃ½ qua ProviderManager + JwtAuthenticationProvider âŸ¶ xÃ¡c thá»±c token thÃ nh cÃ´ng âŸ¶ set vÃ o SecurityContextHolder

ğŸ”¢ BÆ°á»›c 1: Filter Ä‘á»c token Bearer
"The authentication Filter from Reading the Bearer Token passes a BearerTokenAuthenticationToken to the AuthenticationManager..."

âœ… CÃ³ má»™t filter thÆ°á»ng lÃ  BearerTokenAuthenticationFilter hoáº·c OncePerRequestFilter, nÃ³ sáº½:

Láº¥y token tá»« header:

makefile
Copy
Edit
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
Táº¡o object BearerTokenAuthenticationToken chá»©a token Ä‘Ã³

Gá»­i object nÃ y Ä‘áº¿n AuthenticationManager Ä‘á»ƒ xá»­ lÃ½ tiáº¿p

ğŸ”¢ BÆ°á»›c 2: ProviderManager nháº­n yÃªu cáº§u xÃ¡c thá»±c
"The ProviderManager is configured to use an AuthenticationProvider of type JwtAuthenticationProvider."

âœ… AuthenticationManager thá»±c táº¿ lÃ  ProviderManager, nÃ³ kiá»ƒm tra xem cÃ³ AuthenticationProvider nÃ o phÃ¹ há»£p xá»­ lÃ½ BearerTokenAuthenticationToken khÃ´ng.

â¡ï¸ á» Ä‘Ã¢y, nÃ³ dÃ¹ng JwtAuthenticationProvider.

ğŸ”¢ BÆ°á»›c 3: JwtAuthenticationProvider dÃ¹ng JwtDecoder Ä‘á»ƒ xÃ¡c thá»±c token
"JwtAuthenticationProvider decodes, verifies, and validates the Jwt using a JwtDecoder."

âœ… JwtDecoder lÃ  thÃ nh pháº§n chá»‹u trÃ¡ch nhiá»‡m:

Giáº£i mÃ£ token

XÃ¡c thá»±c chá»¯ kÃ½

Kiá»ƒm tra cÃ¡c claims (háº¿t háº¡n, issuer, v.v.)

VÃ­ dá»¥: náº¿u báº¡n dÃ¹ng NimbusJwtDecoder, nÃ³ sáº½ dÃ¹ng public key hoáº·c secret Ä‘á»ƒ xÃ¡c thá»±c token.

ğŸ”¢ BÆ°á»›c 4: Chuyá»ƒn JWT thÃ nh cÃ¡c quyá»n (GrantedAuthority)
"JwtAuthenticationProvider then uses the JwtAuthenticationConverter to convert the Jwt into a Collection of granted authorities."

âœ… Sau khi token há»£p lá»‡, JwtAuthenticationProvider sáº½:

Truyá»n token vÃ o JwtAuthenticationConverter

Converter sáº½ láº¥y cÃ¡c quyá»n (roles) tá»« claim (vÃ­ dá»¥ claim "roles" hoáº·c "scope")

Tráº£ vá» danh sÃ¡ch GrantedAuthority, vÃ­ dá»¥:

java
Copy
Edit
[ROLE_USER, ROLE_ADMIN]
ğŸ”¢ BÆ°á»›c 5: Táº¡o JwtAuthenticationToken vÃ  set vÃ o SecurityContextHolder
"The returned JwtAuthenticationToken will be set on the SecurityContextHolder by the authentication Filter."

âœ… Sau khi xÃ¡c thá»±c xong:

Tráº£ vá» má»™t JwtAuthenticationToken chá»©a:

principal: chÃ­nh lÃ  Jwt

authorities: quyá»n láº¥y tá»« token

Filter gÃ¡n JwtAuthenticationToken vÃ o SecurityContextHolder âœ tá»« Ä‘Ã¢y trá»Ÿ Ä‘i, trong code báº¡n cÃ³ thá»ƒ dÃ¹ng:


BÆ°á»›c	Diá»…n giáº£i
1	Filter Ä‘á»c token tá»« header
2	Táº¡o BearerTokenAuthenticationToken
3	Gá»­i Ä‘áº¿n AuthenticationManager (ProviderManager)
4	Gá»i JwtAuthenticationProvider Ä‘á»ƒ xÃ¡c thá»±c
5	DÃ¹ng JwtDecoder Ä‘á»ƒ decode/verify
6	DÃ¹ng JwtAuthenticationConverter Ä‘á»ƒ táº¡o authorities
7	Tráº£ vá» JwtAuthenticationToken, gÃ¡n vÃ o SecurityContextHolder




